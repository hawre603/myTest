<?php
	//include 'authentication_script.php';			//script checks if user 
	session_start();									//is logged into the system
	if (!isset($_SESSION['username'])) {					//if not, user is redirected
		header("Location: index.php");						//to login page
		exit();
	}
	

	$username=$_SESSION['username'];

/*
* 	   xml file Upload system with PHP.
* 
*     
*/
	include 'validate.php';
	include 'dbCon.php';
	include 'generateCode.php';				//script that generates html5 code
		include 'addGuide.php';						
		
	
	    $xmlfilename=	$_FILES["file"]["name"] ;
		$file_type=$_FILES["file"]["type"] ;
		$file_size=$_FILES["file"]["size"] ;
		$file_tmp= $_FILES["file"]["tmp_name"] ;
		$file_type= $_FILES["file"]["error"] ;
		
$check=false;
		
				if($file_type != 'xml')     
			{
				echo $file_type;
				header("Location: ../wrongformatorsize.php");
				exit();
			 }
		
			
		$title=$_POST['title'];
	
	
			$result = mysqli_query($dbCon,"SELECT * FROM guides");
				while($row = mysqli_fetch_array($result))					
				{
					if((($file_name==$row['name']))||($title==$row['title'])){
						$check=true;
						}
					}
					
	$xmlfilename="../xmlpages/".$guideNameval.'.xml';
	
			move_uploaded_file($file_tmp,$xmlfilename);
			if($check==true)
			{
			
            	// generate page in HTML and store in $HTML5File
				generateHTML5($xmlfilename);

				// add guide to guides log table
				addGuide($_SESSION['username'], $valguideTitle, $guideNameval);
			
			}
			else {
				
			header("Location: ../fileuploaded.php");
			}
			
	
?>